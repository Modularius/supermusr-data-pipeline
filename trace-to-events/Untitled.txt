title This is a title

participant Trace
participant Time Crossed
participant Time Of Last Return
participant Threshold Detector
participant Threshold
participant Duration
participant Event
alt Has Trace Already Crossed?
  Trace->Threshold Detector:(Time,Value)
  create Time Crossed
  linear
  Time Crossed->Threshold Detector: Time Crossed
  Threshold Detector->Threshold: Value
    Threshold Detector->Duration:Time - Time Crossed
  linear off
  alt Is Trace Currently Crossed?
    Threshold-->Threshold Detector:True
    alt
      Duration-->Threshold Detector:Equal
      Threshold Detector->Event: Event at Time Crossed
    else
      Duration-->Threshold Detector:Not Equal
      Threshold Detector->Event: No Event
    end
  else
    Threshold->Threshold Detector:False
    Threshold Detector->Duration:Time - Time Crossed
    alt
      Duration-->Threshold Detector:Equal
      Threshold Detector->*Time Of Last Return: Time
      destroysilent Time Of Last Return
      Threshold Detector->Event: Event at Time Crossed
    else
      Duration-->Threshold Detector:Not Equal
      Threshold Detector->Event: No Event
    end
    Threshold Detector->Time Crossed: Remove
    destroy Time Crossed
  end
else
  Trace->Threshold Detector:(Time,Value)
  create Time Crossed
  Time Crossed->Threshold Detector: None
  destroysilent Time Crossed
  opt Value passed threshold
    alt
      create Time Of Last Return
      Time Of Last Return->Threshold Detector:time_of_last_return
      destroysilent Time Of Last Return
      opt time>=cool off+time_of_last_return
        Threshold Detector->*Time Crossed:Time
        destroysilent Time Crossed
      end
    else
      create Time Of Last Return
      Time Of Last Return->Threshold Detector:None
      destroysilent Time Of Last Return
      Threshold Detector->*Time Crossed:Time
      destroysilent Time Crossed
    end
  end
    Threshold Detector->Event: No Event
end